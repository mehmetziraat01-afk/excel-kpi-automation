{% extends "_layout.html" %}
{% block title %}Corporate Dashboard{% endblock %}
{% block content %}
<h1 class="mb-3">Corporate Dashboard</h1>
<p class="text-muted">Date: {{ today }}</p>

<div class="row g-3 mb-4">
  <div class="col-md-4 col-lg-2"><div class="card shadow-sm h-100"><div class="card-body"><div class="text-muted small">Total Stock (kg)</div><div class="fs-4 fw-bold">{{ '%.3f'|format(total_stock) }}</div></div></div></div>
  <div class="col-md-4 col-lg-2"><div class="card shadow-sm h-100"><div class="card-body"><div class="text-muted small">Today IN (kg)</div><div class="fs-4 fw-bold">{{ '%.3f'|format(today_in) }}</div></div></div></div>
  <div class="col-md-4 col-lg-2"><div class="card shadow-sm h-100"><div class="card-body"><div class="text-muted small">Today OUT_PRODUCTION (kg)</div><div class="fs-4 fw-bold">{{ '%.3f'|format(today_out_production) }}</div></div></div></div>
  <div class="col-md-4 col-lg-2"><div class="card shadow-sm h-100"><div class="card-body"><div class="text-muted small">Today OUT_CORRECTION (kg)</div><div class="fs-4 fw-bold">{{ '%.3f'|format(today_out_correction) }}</div></div></div></div>
  <div class="col-md-4 col-lg-2"><div class="card shadow-sm h-100"><div class="card-body"><div class="text-muted small">Suspicious batches</div><div class="fs-4 fw-bold">{{ suspicious_batches }}</div></div></div></div>
</div>

<div class="row g-3">
  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header fw-semibold">Stock by material</div>
      <div class="table-responsive" style="max-height: 360px;"><table class="table table-striped table-sticky mb-0"><thead><tr><th>material_name</th><th class="text-end">current_stock_kg</th></tr></thead><tbody>
        {% for row in stock_rows %}<tr><td>{{ row.material_name }}</td><td class="text-end">{{ '%.3f'|format(row.current_stock_kg) }}</td></tr>{% else %}<tr><td colspan="2" class="text-center text-muted">No records</td></tr>{% endfor %}
      </tbody></table></div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card shadow-sm">
      <div class="card-header fw-semibold">Today movement totals</div>
      <div class="table-responsive" style="max-height: 360px;"><table class="table table-striped table-sticky mb-0"><thead><tr><th>movement_type</th><th class="text-end">total_kg</th></tr></thead><tbody>
        {% for row in movement_summary %}<tr><td>{{ row.movement_type.value }}</td><td class="text-end">{{ '%.3f'|format(row.total_kg) }}</td></tr>{% else %}<tr><td colspan="2" class="text-center text-muted">No records</td></tr>{% endfor %}
      </tbody></table></div>
    </div>
  </div>
</div>

<div class="card shadow-sm mt-3">
  <div class="card-header fw-semibold">Son 10 Analiz Uyarısı</div>
  <div class="table-responsive" style="max-height: 320px;">
    <table class="table table-striped table-sticky mb-0">
      <thead><tr><th>date</th><th>material</th><th>type</th><th>reason</th><th>value</th><th>severity</th></tr></thead>
      <tbody>
      {% for a in alerts %}
        <tr>
          <td>{{ a.date }}</td><td>{{ a.material }}</td><td>{{ a.type }}</td><td>{{ a.reason }}</td><td>{{ a.value }}</td>
          <td><span class="badge {% if a.severity == 'RED' %}text-bg-danger{% else %}text-bg-warning{% endif %}">{{ a.severity }}</span></td>
        </tr>
      {% else %}
        <tr><td colspan="6" class="text-center text-muted">No alerts</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
